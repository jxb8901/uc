/**
  *是否自动引入函数中出现在表，不管是否自动引入，
  *如果规则中只是出现:按比例积分(客户积分.消费积分, 交易.金额, 300, 5)
  *则规则解析时会出错，如何解决？
  */
 /**
  *送短信("")
  *
  */
[regularRule]
	switch {
	case 交易.交易日期.月份 == 12月 :
		按比例积分(积分.消费积分, 交易.金额, 200, 3)
	case 交易.日期 == "20061225" and 客户.性别 == "女" :
		按比例积分(积分.消费积分, 交易.金额, 300, 5)
	default :
		积分.消费积分 += 交易.金额 / 80 * 2 + 5
	}
	if 客户.性别 == "女"
		积分.消费积分 *= 100
[cycleRule frequency = "月"]
	if 交易.金额 > 80
	{
		agg {
		   if  笔数 >= 1
		  {
			if 客户.性别 == "女"
				积分.消费积分 += 200 
			else
				积分.消费积分 += 100 
		   }
		}
	}
	
	agg( 交易.金额, "总金额") {
		order(总金额 , 3, desc){
			if 客户.性别 == "男" 
				积分.消费积分 += 200 
			else
				积分.消费积分 += 100 
		}
	}
	

[cycleRule frequency = "结束"]
	if 交易.金额 > 80
	{
		agg {
		   if  笔数 >= 1
		  {
				积分.消费积分 += 200 
		   }
		}
	}


